### <a name="_b7urdng99y53"></a>Архитектура АгроТех MVP автоматизации животноводческого хозяйства 
### <a name="_hjk0fkfyohdk"></a>Войтещук Анна
### <a name="_uanumrh8zrui"></a>21.12.2025
### <a name="_3bfxc9a45514"></a>

| :-: | :- | :- | :- |
|UC0-1|	"Администратор Платформа"|	Администрирование доступа|	"Администратор 1. заходит в интерфейс управления пользователями 2. Создает учетки пользователей с возможностью первого входа 3. Указывает им список ролей доступа 4. Указывает фермы, к которым разрешен доступ"|
|UC0-2|	"Пользователь Клиентское приложение Платформа"|	Аутентификация|	"1. Пользователь открывает клиентское приложение и не залогинен. 2. Платформа проводит пользователя через многофакторную аутентификацию 3. Платформа возвращает JWT токены, разрешающие доступ к информации системы"|
|UC0-3|	"Клиентское приложение Платформа"|	Авторизация|	"Клиентское приложение запрашивает информацию, а токен доступа невалиден Платформа отказывает в информации"|
|UC0-4|	"Платформа Клиентское приложение"|	Общая реакция на события|	"1. Произошло подотчетное событие 2. Клиентские приложения авторизованных пользователей получают уведомление о новом событии 3. Клиентские приложения могут получить подробности события: место, категорию, описание 4. Клиентские приложения могут получить страницы из журнала событий, к которым разрешен доступ"|
|UC0-5|	"Платформа Клиентское приложение дежурного Клиентское приложение администратора"|	Разрыв связи между центром и фермой	|"1. Платформа инициирует событие ""отсутствие связи с сервером N минут"". 2. Платформа реагирует на событие согласно UC0-4. Уведомление получает: -дежурный на ферме: -администратор центра 3. Клиентское приложение дежурного сохраняет возможность просматривать и управлять фермой, на которой он находится"|
|UC0-6|	Платформа	|Восстановление связи	|"1. Платформа иницирует событие ""восстановлении связи с центром"" 2. Платформа реагирует на событие согласно UC0-4 Уведомление получает: -дежурный на ферме: -администратор центра"|
|UC1-0|	"Видеокамеры Платформа Клиентское приложение"	|Поведение животных|	"1. На территории фермы в зоне видеокамер в поведении животных произошло подотчетное событие:: -беспокойство: -гибель: -признаки болезни: -признаки задавливания поросят: -и т д 2. Платформа реагирует на сообщение согласно UC-04 3. В описании события доступна ссылка на видеофрагмент"|
|UC1-1|	"Клиентское приложение Платформа"|	Состояние животных	|"1. Клиентское приложение авторизованного пользователя запрашивает у платформы сводную информацию о состоянии животных в вальере или на ферме: -поголовье: -болезнь: -итд 2. Платформа передает информацию"|
|UC2-1|	"Авто-поилка Платформа Клиентское приложение дежурного"|	Операционное событие на авто-поилке	|"1. Авто-поилка инициировала операционное событие: -низкий уровень воды / вода закончилась 2. Платформа реагирует на событие согласно UC0-4"|
UC2-2|	"Клиентское приложение дежурного Платформа"|	Операционное состояние авто-поилки|	"1. Клиентское приложение запрашивает у платформы информацию о состояния поилок и их расходников 2. Платформа передает информацию клиентскому приложению авторизованного пользователю"|
|UC2-3|	"Клиентское приложение дежурного Платформа Авто-поилка"	|Управление авто-поилкой	|"1. Клиентское приложение отправляет платформе команду управления поилкой: -включить выключить насос: -выключить подачу воды 2. Платформа транслирует команду авто-поилке 3. Авто-поилка инициирует событие о переключении UC6 4. Платформа реагирует на событие согласно UC0-4"|
|UC2-4|	"Авто-поилка Платформа Клиентское приложение инженера Клиентское приложение дежурного"|	Техническое событие на авто-поилке	|"1. Авто-поилка инициировала событие о техническом состоянии: -пора заменить фильтр / пора почистить лоток или насос: -ошибка насоса / двигателя: -отключение-восстановление питания 2. Платформа реагирует на событие согласно UC0-4: -инженер получает начальные уведомления: -дежурный получает сводное уведомление о работоспособности поилки"|
|UC3-1|	"Авто-кормушка Платформа Клиентское приложение дежурного"	|Операционное событие на авто-кормушки	|"1. Авто-кормушка инициировала операционное событие: -кормление началось/закончилось: -низкий уровень корма/корм закончился: -застревание корма: -пропуск кормления 2. Платформа реагирует на событие согласно UC0-4"|
|UC3-2|	"Клиентское приложение дежурного Платформа"	|Операционное состояние авто-кормушки	|"1. Клиентское приложение запрашивает у платформы информацию об операционном состоянии кормушек 2. Платформа передает информацию клиентскому приложению авторизованного пользователя"|
|UC3-3|	"Клиентское приложение дежурного Платформа Авто-кормушка"	|Управление авто-кормушкой	|"1. Клиентское приложение отправляет платформе команду управления поилкой: -установить расписание: -установить размер порции: -добавить-пропустить кормление 2. Платформа транслирует команду авто-поилке 3. Авто-поилка инициирует событие о переключении UC6 4. Платформа реагирует на событие согласно UC0-4"|
|UC3-4|	"Авто-кормушка Платформа Клиентское приложение инженера Клиентское приложение дежурного"	|Техническое событие на авто-кормушке|	"1. Авто-кормушка инициировала событие о техническом состоянии: - отключение-восстановление питания: -ошибка механизма 2. Платформа реагирует на событие согласно UC0-4: -инженер получает начальные уведомления: -дежурный получает сводное уведомление о работоспособности кормушки"|
|UC4-1|	"Платформа Клиентское приложение снабжения"	|Мониторинг запаса корма	|"Клиентское приложение посылает платформе информацию о кол-ве оставшегося на ферме корма Клиентское приложение может получить журнал коррекции запасов корма на ферме"|
|UC4-2|	"Платформа Клиентское приложение снабжения"|	Мониторинг пополнения запасов корма	|"Клиентское приложение посылает платформе информацию о кол-ве завезенного на ферму корма Клиентское приложение может получить журнал пополнения запасов корма на ферме"|
|UC4-3|	"Платформа Клиентское приложение снабжения Клиентское приложение дежурного"	|Запас корма недостаточен|	"1. Расчетный уровень запасов корма на ферме ниже согласованного уровня 2. Платформа инициирует событие ""запас корма недостаточен"" 3. Платформа реагирует на событие согласно UC0-4. Уведомление получают дежурный и снабжение"|
|UC5-1|	"Администратор Платформа Платформа Агротех"|Настройка интеграции|	"Администратор редактирует список событий для трансляции Платформа начинает вести себя по UC5-1 с обновленным списком"|
|UC5-2|	"Платформа Платформа Агротех"	|Трансляция событий	|"1. Платформа зарегистрировала событие из списка для трансляции 2. Платформа транслирует его в канал связи Агротех"|

### <a name="_u8xz25hbrgql"></a>

| :-: | :- |
|RA1|	должна быть построена по принципу центральный сервер-агенты на конкретных фермах без ограничения количества таких агентов|
		
|RA2|	На каждой ферме допустимо использовать один центральный сервер и необходимый набор edge-устройств.|
		
|R1|	обеспечивать достаточно высокую отказоустойчивость 99,95%;|
		
|R2	|Архитектура должна работать даже в случае отсутствия интернета	|
|R2-1|		и при необходимости отправлять уведомления дежурному сотруднику на местах мониторинга,|
|R2-2|		а после восстановления связи синхронизироваться с центральной системой;|
|R2-3|		в синхронизации между агентами и центральным сервером допускается задержка до 10 минут без учёта проблем со связью.|
		
|P1	|не более 5 секунд от момента возникновения нештатной ситуации, зафиксированной с помощью видеоаналитики до момента оповещения;|
|P2	|Архитектура должна позволять системе видеоаналитики реагировать в реальном времени (миллисекунды).|	
		
|S1	|Архитектура должна быть расширяемой, то есть иметь возможность разработать новый функционал без изменений существующего;|
|RI1|		иметь API для создания мобильного приложения или веб-приложения.|

|RE0-1|	На ферме нестабильный WiFi поэтому нужно продумать альтернативные каналы связи.|
|RE1-1|	Покрытие камерами всей площади нужно по максимуму убрать слепые зоны либо воспользоваться камерами типа «рыбий глаз», но это снизит качество в силу выпуклости линзы.|
		
|RE1-2|	Проблемы с освещением — камеры должны уметь снимать и в ночное время суток.	|
		
|RE1-3|	Поддерживать необходимое количество видеокамер для аналитики в реальном времени	|
|RE1-4|	Поддерживать видеокамеры от разных производителей	|
|RE2-1|	Управлять поилками и кормушками разных производителей	|
		
|N1|	Часто нейронные сети путают тень животного с самим животным — для MVP не критично.	|
|N2| 	Трекинг животных достаточно сложен, так как особи очень похожи.	|
|N3|	Готовую нейросетевую модель предоставят партнёры.|

### <a name="_qmphm5d6rvi3"></a>
ADL уровня С1
	ADR	"Контекст: Исходя из целей бизнеса, система должна повлиять на деятельность группы в том числе ""руководства""
	Причина: В списке требований нет пунктов, относящихся к руководству.
	Решение: Не добавляю требования к MVP. Функциональность для руководства не является первостепенной для запуска MVP. 
	Так как требует периодически, на этапе MVP создаем необходимые отчеты вручную по запросу.
	Цель: Ускорение запуска MVP. Прояснение на практике функциональных требований для интерфейса руководства
	Компромиссы: Временно появляются ручные операции и оперативная реакция на запросы.
	Интерфейс руководства понадобится на этапе перехода к Saas"

	ADR	"Контекст: Исходя из целей бизнеса, система должна повлиять на деятельность группы в том числе ""инженер/механик"". 
	Причина: В списке требований нет пунктов слежения за состоянием оборудования или относящихся к инженеру.
	Решение: Добавляю функциональность для инженера. Так как она критична для тестирования и отладки работы оборудования
	Цель: 
	Процесс отладки автоматизированных процессов упрощается
	Система всегда знает, когда недополучает информацию
	Компромиссы: проект MVP для разработки увеличивается."

	ADR	"Контекст: Есть требования к интеграции с внешними системами
	Причина: Нет подробностей интеграции.
	Решение: Первично обеспечиваем интеграцию именно под запросы цифровой платформы AgroTech.
	Так как на этапе MVP это единственная заинтересованная в интеграции система и она уже умеет агрегировать, хранить и обрабатывать данные. 
	Цель: Минимальный объем разработки для MVP
	Возможность переиспользовать части существующей системы АгроТех
	Компромиссы: Тестовый проект интегрируется в систему, введенную в эксплуатацию."

	ADR	"Контекст: В списке требований нет пунктов относящихся к интерфейсу администратора системы
	Причина: Систему PigSystem необходимо администрировать
	Решение: В режиме MVP администрируем мы как разработчики на коленке, скриптами.
	Цель: Тестовый запуск ускорится
	Компромисс: Временно появляются ручные операции и оперативная реакция на запросы по администрированию.
	Интерфейс администратора понадобится на этапе перехода к Saas"

ADL выбора архитектуры
	S1	"Контекст: архитектура должна быть расширяемой
		Решение:
		В ее основу закладываем
		- микросервисность
		- событийность(Event-Driven Architecture, EDA)
		- стандартизацию оборудования через программные адаптеры
		Компромиссы:
		Объем для разработки и отладки, и квалификация команды существенно выше, чем для монолита и синхронных взаимолействий"
	"R2 P1"	"Контекст: чтобы архитектура работала даже в отсутствии интернета, 
		Решение: Микросервисы управления фермой и точка доступа к API развернуты на сервере-агенте фермы
		Компромиссы:
		Преимущества ""облачности"" размываются.
		Вырастает объем работы по администрированию, сопровождению и развитию - отлаживать сервисы на каждом сервере-агенте отдельно.
		Вырастает уровень требований для оборудования сервер-агента.
		Усложняется процедура перехода системы на новые версии."
	R1	"Причина: Обеспечить отказоустойчивость 99,95% (4,38 часа простоя в год) 
		Решение:
		1. Принцип автономности Edge - Сервисы управления фермой развернуты на сервере фермы
		2. Принцип избыточности - Каждый критически важный компонент системы должен дублироваться
		В ПО и оборудовании
		- локальный брокер сообщений кластеризован
		- локальные микросервисы кластеризованы
		- локальная БД кластеризована
		- сервисы центрального сервера развернуты в режиме высокой доступности
		Компромисс: 
		Рост затрат на ключевое оборудование в 2-3 экземплярах
		Усложняется администрирование системы, так как растет количество объектов администрирования
		Усложняется архитектура - нужна и локальная, и центральная точка доступа к API, нужна согласованность локальной и центральной точки доступа к API"
		
### <a name="_bjrr7veeh80c"></a>**Альтернативы**
Альтернативные решения: 
- Монолит
- Микросервисы на синхронном взаимодействии

**Недостатки, ограничения, риски** 
	- Объем для разработки и отладки, и квалификация команды существенно выше, чем для монолита и синхронных взаимолействий"

	При локальном управлении фермой и обеспечении доступности 99,95%:
	- Преимущества ""облачности"" размываются.
	- Вырастает объем работы по администрированию, сопровождению и развитию - отлаживать сервисы на каждом сервере-агенте отдельно.
	- Вырастает уровень требований для оборудования сервер-агента.
	- Усложняется архитектура - нужна и локальная, и центральная точка доступа к API, нужна согласованность локальной и центральной точки доступа к API"		
	
	"Исходный список требований MVP выглядит, как способ проверить сразу 3 основные гипотезы. Во сколько бизнесу обойдется:
	1. Автоматизация в принципе - можно ли автоматизировать значимые операции ухода за животными
	2. Масштабирование автоматизации - может ли автоматизация охватить всю территорию фермы и все фермы
	3. Обеспечение надежности - может ли автоматизация гарантировать свою безотказность
	Система, удовлетворяющая всем этим требованиям, превосходит масштабы MVP по размеру и стоимости разработки, развертывания, сопровождения и обеспечению оборудованием"